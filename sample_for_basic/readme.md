uniskie 2022/08/30 追記

## プログラムと効果音

こちらのフォルダの効果音やプログラムソースはhra!さんのライセンスに準じます。  
再利用はご自由にご活用ください。

## BGM

このフォルダ以外のBGMデータ(xeviyokeのBGM)は三毛乱ジェロさんの著作なので再利用はお控えください。  

このフォルダのbgm02に関してはuniskie作なので再利用して頂いても大丈夫です。

## MMLコンパイル

bgm02.bat がサンプルになります。
コマンドは

### BSAVE形式（アドレスは000hから）
````mc.exe bgm02.txt bgm02.asm bgm02.bin bsave````

* 最後のbsaveはとにかくなんでもよいので文字が入っていればOKです。

### 生バイナリ形式（ヘッダなし）
````mc.exe bgm02.txt bgm02.asm bgm02.bin````

* 4番目のパラメータに何もなければ生バイナリデータでセーブされます。

### バイナリなし。asmのみ
````mc.exe bgm02.txt bgm02.asm````

## bgmdriver エントリー

※ BASICからの呼び出しについては```sample.bas```と```sample.asm```を参照ください。


| ラベル名                    | 機能                     | 引数                                                |
|-----------------------------|--------------------------|-----------------------------------------------------|
| bgmdriver_initialize        |ドライバを初期化する      |                                                     |
| bgmdriver_play              |BGMを演奏する             | HL...BGMデータのアドレス                            |
| bgmdriver_stop              |BGMを演奏終了する         | なし                                                |
| bgmdriver_pause             |BGM一時停止/解除          | A ... 1=一時停止 / 0=一時停止解除                   |
| bgmdriver_is_pause          |BGMが一時停止中か調べる   | Z ... ZフラグがONなら一時停止中                     |
| bgmdriver_check_playing     |BGMが演奏中か調べる       | Z ... ZフラグがONなら演奏中                         |
| bgmdriver_fadeout           |BGMをフェードアウトさせる | A ... フェードアウトウェイト                        |
| bgmdriver_play_sound_effect |効果音を再生する          | HL ... 効果音データのアドレス                       |
|(その他)                     |                          |                                                     |
| bgmdriver_mute_psg          |PSGを強制的に消音する     | PSGレジスタを直接操作。演奏中だと演奏で上書きされる |
| bgmdriver_interrupt_handler |割り込み中の処理をする    | H.TIMIから呼び出す                                  |

## 効果音データ

|位置| 内容          |サイズ| 値                            |
|----|---------------|------|-------------------------------|
|  +0| プライオリティ| 1    | 0～255 小さいほど優先度が高い |
|  +1| データ本体    | 任意 |                               |
|最後| 終了ID        | 1    | BGM_SE_END(0x04)              |

### 効果音データ本体

```ID```+```パラメータ```で構成
```ID```は1byte、```パラメータ```は ```BGM_SE_FREQ```が2byteでそれ以外は1byte

|ID名              | ID値 | サイズ | 内容                                                    |
|------------------|------|--------|---------------------------------------------------------|
|BGM_SE_FREQ       | 0    | 1+2=3  |トーン周波数 0x000～0xFFF (※ 0x8000ならトーンOFF)       |
|BGM_SE_VOL        | 1    | 1+1=2  | 音量 0～15                                              |
|BGM_SE_NOISE_FREQ | 2    | 1+1=2  | ノイズ周波数 (0～31)+0x80 (※ +0x80が無ければノイズOFF) |
|BGM_SE_WAIT       | 3    | 1+1=2  | 指定した時間待つ                                        |
